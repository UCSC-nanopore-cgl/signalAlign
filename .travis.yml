python:
- 3.5
notifications: # set notification options
  slack:
    rooms:
    - ucsc-cgl:Edwfgt7MJEVZV9Lib3igueTF
    on_success: change
    on_failure: always
  email: false

os:
- linux
- osx

git:
  submodules: false

before_install:
- git submodule update --init
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
  brew update;
  brew install gcc@5 autoconf automake libtool make;
  wget https://repo.anaconda.com/archive/Anaconda2-5.3.1-MacOSX-x86_64.sh -O anaconda.sh;

  else

    sudo apt-get update -qq;
    sudo apt-get install autotools-dev autoconf cmake make;
    sudo apt-get update;
    wget https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh -O anaconda.sh;

  fi
- bash anaconda.sh -b -p $HOME/anaconda3


install:
- export PATH="$HOME/anaconda3/bin:$PATH"
- export C_INCLUDE_PATH="$HOME/anaconda3/envs/signalalign/include:$C_INCLUDE_PATH"
- export LD_LIBRARY_PATH="$HOME/anaconda3/envs/signalalign/lib:$LD_LIBRARY_PATH"
- export LIBRARY_PATH="$LIBRARY_PATH:$HOME/anaconda3/envs/signalalign/lib"

- hash -r
- conda config --set always_yes yes --set changeps1 no
- conda update -q conda
# Useful for debugging any issues with conda
- conda info -a
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
  conda env create -f requirements2.yml python=3.6;
  else
  conda env create -f requirements.yml python=3.6;
  fi

- source activate signalalign
- make

before_script: # configure a headless display to test plot generation
- "export DISPLAY=:99.0"
- "sh -e /etc/init.d/xvfb start"
- sleep 3 # give xvfb some time to start

script:
- export PATH=$PATH:$PWD/bin
- make test

